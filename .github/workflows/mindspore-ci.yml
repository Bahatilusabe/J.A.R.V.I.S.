name: MindSpore CI

on:
  workflow_dispatch:
    inputs:
      run_minspore:
        description: 'Set to yes to run MindSpore CI job'
        required: true
        default: 'no'

jobs:
  mindspore-test:
    if: ${{ github.event.inputs.run_minspore == 'yes' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Upgrade pip
        run: python -m pip install --upgrade pip

      - name: Install test deps
        run: |
          python -m pip install pytest
          # Install MindSpore CPU wheel for Ubuntu - adjust version if needed
          python -m pip install mindspore==2.6.0 || python -m pip install mindspore

      - name: Run MindSpore adversarial test
        env:
          RUN_MINDSPORE_CI: '1'
        run: |
          pytest -q backend/core/deception/tests/test_mindspore_adversarial.py -q
